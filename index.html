<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>판교비 타자 게임</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to bottom, #16213e 0%, #000000 100%);
            font-family: 'Malgun Gothic', sans-serif;
        }
        #gameContainer {
            text-align: center;
        }
        canvas {
            /* border: 3px solid #0f3460; */
            background: linear-gradient(to bottom, #0a1128 0%, #1a1a2e 100%);
            box-shadow: 0 0 30px rgba(136, 165, 185, 0.3);
        }
        #info {
            margin-top: 20px;
            color: #ffffff;
            font-size: 24px;
            font-weight: bold;
        }
        #input {
            margin-top: 15px;
            padding: 12px 20px;
            font-size: 20px;
            width: 500px;
            border: 2px solid #0f3460;
            border-radius: 8px;
            background: #16213e;
            color: #fff;
            text-align: center;
            outline: none;
        }
        #input:focus {
            border-color: #3da861;
        }
        .overlay {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(75, 75, 75, 0.95);
            padding: 20px;
            text-align: center;
            z-index: 100;
        }
        .overlay h2 {
            color: #ffffff;
            font-size: 48px;
            margin-bottom: 20px;
        }
        .overlay h3 {
            color: #fff;
            font-size: 28px;
            margin-bottom: 30px;
        }
        .overlay p {
            color: #bbb;
            font-size: 18px;
            margin: 10px 0;
            line-height: 1.6;
        }
        .overlay ul {
            text-align: left;
            color: #bbb;
            font-size: 18px;
            margin: 20px auto;
            max-width: 400px;
            line-height: 1.8;
        }
        .gameBtn {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 24px;
            background: #3da861;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        .gameBtn:hover {
            background: #73f39e;
            transform: scale(1.05);
        }
        #finalScore, #finalLevel {
            color: #fff;
            font-size: 24px;
            margin: 15px 0;
        }
    </style>
    <script src="https://grggames.com/grg-games-sdk.min.js"></script>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="info">점수: 0 | 목숨: ❤️❤️❤️ | 레벨: 1</div>
        <input type="text" 
            oncopy="return false" 
            onpaste="return false" 
            oncut="return false"
            id="input" placeholder="여기에 입력하세요" autocomplete="off">
    </div>
    
    <div id="startScreen" class="overlay" style="display: block;">
        <img src="./assets/main.png" alt="게임 이미지" style="width: 600px; margin-bottom: 20px; border-radius: 10px;">
        <h2>🌧️ 판교비 타자 게임 🌧️</h2>
        <ul>
            <li>💧 하늘에서 떨어지는 단어를 입력하세요</li>
            <li>⌨️ 입력 후 <strong>엔터</strong>를 눌러 제출!</li>
            <li>❤️ 목숨은 3개, 단어가 땅에 닿으면 -1</li>
            <li>📈 최대 10단계 레벨 업!</li>
            <li>⚡ 레벨이 오를수록 어려워져요~</li>
        </ul>
        <button class="gameBtn" id="startBtn">게임 시작</button>
    </div>
    
    <div id="gameOver" class="overlay">
        <h2>게임 오버!</h2>
        <p id="finalScore">최종 점수: 0</p>
        <p id="finalLevel">최종 레벨: 1</p>
        <button class="gameBtn" id="restartBtn">다시 하기</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const input = document.getElementById('input');
        const infoDiv = document.getElementById('info');
        const startScreen = document.getElementById('startScreen');
        const gameOverDiv = document.getElementById('gameOver');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');

        const WORDS_BY_LEVEL = {
            1: ['이슈', '콜백', '소켓', '니즈', '슬랙', '디코', '멘션', '롤백', '장애', '아삽'],
            2: ['킥오프', '디폴트', '얼라인', '워킹데이', '트래킹', '피드백', '팔로업'],
            3: ['리소스', '마일스톤', '배포', '깃헙', '커밋', '컴', '디벨롭', '와우팩터'],
            4: ['모니터링', '빌드', '로드맵', '풀스택', '지라', '어사인', 'API', '스크럼', '에자일'],
            5: ['프론트', '백엔드', 'SDK', 'ISMS', '마크업', 'ESG'],
            6: ['ITGC', '리붓', '리전', 'AWS', 'IDC', '타임아웃', '이직의다리'],
            7: ['노운이슈', '엣지케이스', '스펙아웃', '데드라인', '코드프리즈'],
            8: ['러프하게 일정 주세요', 
                '멘션 추가해 주세요', 
                '이슈업 부탁드립니다', 
                '인증서 싱글로 발급해도 될까요?', 
                '호스트 넣으셨어요?',
                '워킹데이로 3일 입니다',
                '코드 프리즈 중입니다',
                '이슈 팔로업 필요합니다',
            ],
            9: ['캐시 날리고 확인 부탁드려요', 
                '이슈가 있어 롤백 하겠습니다', 
                'QA 사인오프 되었습니다', 
                '화이트리스트 적용 하였습니다', 
                '그라파나 대시보드 추가 하였습니다',
                "오늘 안건 얼라인 필요합니다",
                "금주 스프린트 범위 컨펌 부탁",
                "데드라인 임박, 리소스 체크",
                "이슈는 노션에 업로드 완료",
                "슬랙 쓰레드로 팔로업 해주세요",
                "핫픽스 배포라 롤백 대비하세요",
                "다음 스텝은 킥오프 미팅에서",
                "데이터 드리븐으로 결정합시다",
                "이번 주말엔 코드 프리즈 들어갑니다",
                "핵심 KPI는 다음 위클리 때 공유",
            ],
            10: ['하이퍼바이저에서 리시브패킷 에러가 발생하고 있습니다', 
                 '구 버전의 클라이언트를 가진 유저는 diff 발생 분 부터 받게 됩니다', 
                 '간헐적으로 504 게이트웨이 타임아웃 메시지가 확인되고 있습니다', 
                 '금일 AWS DX 구간의 네트워크 순단이 발생하였습니다',
                 "일부 노드에서 디스크 I/O 지연 현상이 관찰되고 있습니다",
                 "DB 커넥션 풀 고갈로 인해 간헐적 요청 실패가 발생하고 있습니다",
                 "특정 리전의 캐시 서버 응답 속도가 평소 대비 저하되고 있습니다",
                 "웹소켓 연결이 불안정하게 끊기는 현상이 보고되고 있습니다",
                 "서비스 내부 API 호출 시 타임아웃 빈도가 증가하고 있습니다",
                 "일부 사용자의 로그인 요청에서 인증 지연이 확인되고 있습니다",
                 "배치 작업 실행 중 예외 발생으로 처리 지연이 발생하였습니다",
                 "트래픽 급증으로 인해 로드밸런서 레이턴시가 상승하고 있습니다",
                 "메시지 큐 적체로 인한 이벤트 처리 지연이 확인되고 있습니다",
                 "파일 업로드 시점에 네트워크 오류로 전송 실패 증가"
                ]
        };

        let gameState = {
            score: 0,
            lives: 3,
            level: 1,
            drops: [],
            isGameOver: false,
            isPlaying: false,
            lastDropTime: 0,
            dropInterval: 2000,
            baseSpeed: 0.5,
            levelSpeed: [ 0, 1, 2, 3, 4, 5, 6, 6, 0.5, 0.5, 0.5 ],
            levelInterval: [ 0, 2000, 2000, 1900, 1900, 1800, 1800, 1700, 1700, 4000, 4000, 4000]
        };

        const colors = [
            'rgba(0, 255, 255, 0.8)',      // 시안 네온
            'rgba(255, 0, 255, 0.8)',      // 마젠타 네온
            'rgba(0, 255, 127, 0.8)',      // 스프링 그린
            'rgba(255, 20, 147, 0.8)',     // 핫 핑크
            'rgba(57, 255, 20, 0.8)',      // 라임 그린
            'rgba(255, 165, 0, 0.8)',      // 오렌지 네온
            'rgba(138, 43, 226, 0.8)',     // 블루 바이올렛
            'rgba(255, 255, 0, 0.8)',      // 옐로우 네온
            'rgba(0, 191, 255, 0.8)',      // 딥 스카이 블루
            'rgba(255, 105, 180, 0.8)'     // 핫 핑크
        ]

        class Drop {
            constructor(level) {
                const words = WORDS_BY_LEVEL[level] || WORDS_BY_LEVEL[10];
                this.char = words[Math.floor(Math.random() * words.length)];
                this.fontSize = this.char.length > 8 ? 18 : (this.char.length > 4 ? 24 : 36);
                this.x = Math.random() * (canvas.width - (this.char.length * this.fontSize));
                this.y = -30;
                this.speed = gameState.baseSpeed + gameState.levelSpeed[gameState.level] * 0.5;
                this.color = colors[Math.floor(Math.random() * colors.length)]
                console.log(this.speed)
            }

            update() {
                this.y += this.speed;
            }

            draw() {
                ctx.save();
                ctx.fillStyle = this.color;
                ctx.font = `bold ${this.fontSize}px Malgun Gothic`;
                ctx.textAlign = 'left';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.char, this.x, this.y);
                ctx.restore();
            }

            isOnGround() {
                return this.y >= canvas.height - 30;
            }
        }

        function init() {
            gameState = {
                score: 0,
                lives: 3,
                level: 1,
                drops: [],
                isGameOver: false,
                isPlaying: false,
                lastDropTime: 0,
                dropInterval: 2000,
                baseSpeed: 0.5,
                levelSpeed: [ 0, 1, 2, 3, 4, 5, 5, 5, 0.5, 0.5, 0.5 ],
                levelInterval: [ 0, 2000, 2000, 1900, 1900, 1800, 1800, 1700, 1700, 4000, 4000, 4000]
            };
            input.value = '';
            input.disabled = true;
            gameOverDiv.style.display = 'none';
        }

        function startGame() {
            startScreen.style.display = 'none';
            gameState.isPlaying = true;
            input.disabled = false;
            input.focus();
            requestAnimationFrame(gameLoop);
        }

        function updateLevel() {
            const newLevel = Math.min(10, Math.floor(gameState.score / 10) + 1);
            if (newLevel !== gameState.level) {
                gameState.level = newLevel;
                gameState.dropInterval = gameState.levelInterval[gameState.level];
            }
        }

        function getLevel(score) {
            if (score < 9) return 1
            else if (score >= 9 && score < 21) return 2
            else if (score >= 21 && score < 33) return 3
            else if (score >= 33 && score < 45) return 4
            else if (score >= 45 && score < 57) return 5
            else if (score >= 57 && score < 69) return 6
            else if (score >= 69 && score < 81) return 7
            else if (score >= 81 && score < 105) return 8
            else if (score >= 105 && score < 129) return 9
            else if (score >= 129) return 10
        }


        function addDrop(currentTime) {
            if (currentTime - gameState.lastDropTime > gameState.dropInterval) {
                gameState.drops.push(new Drop(gameState.level));
                gameState.lastDropTime = currentTime;
            }
        }

        function updateDrops() {
            for (let i = gameState.drops.length - 1; i >= 0; i--) {
                gameState.drops[i].update();
                
                if (gameState.drops[i].isOnGround()) {
                    gameState.drops.splice(i, 1);
                    gameState.lives--;
                    
                    if (gameState.lives <= 0) {
                        endGame();
                    }
                }
            }
        }

        const backgroundImage = new Image();
        backgroundImage.src = './assets/pangyo.png';

        function drawBackground() {
            // 이미지를 캔버스 크기에 맞게 그리기
            ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
            
            // 반투명 오버레이 (선택사항 - 글자 가독성 향상)
            ctx.fillStyle = 'rgba(10, 17, 40, 0.3)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function drawDrops() {
            gameState.drops.forEach(drop => drop.draw())
        }

        function checkInput() {
            const userInput = input.value.trim();
            if (userInput === '') return;

            for (let i = 0; i < gameState.drops.length; i++) {
                if (gameState.drops[i].char === userInput) {
                    gameState.drops.splice(i, 1);
                    gameState.score += Math.min(6, userInput.length);
                    input.value = '';
                    updateLevel();
                    break;
                }
            }

            input.value = '';
        }

        function updateInfo() {
            const hearts = '❤️'.repeat(gameState.lives);
            infoDiv.textContent = `점수: ${gameState.score} | 목숨: ${hearts} | 레벨: ${gameState.level}`;
        }

        function endGame() {
            gameState.isGameOver = true;
            input.disabled = true;
            gameOverDiv.style.display = 'block';
            document.getElementById('finalScore').textContent = `최종 점수: ${gameState.score}`;
            document.getElementById('finalLevel').textContent = `최종 레벨: ${gameState.level}`;
            try {
                GRGScore.onGameEnd(gameState.score);
            } catch {
                //pass
            }            
        }

        function gameLoop(currentTime) {
            if (gameState.isGameOver || !gameState.isPlaying) return;

            drawBackground();
            addDrop(currentTime);
            updateDrops();
            drawDrops();
            updateInfo();

            requestAnimationFrame(gameLoop);
        }

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                checkInput();
            }
        });

        startBtn.addEventListener('click', startGame);
        
        restartBtn.addEventListener('click', () => {
            init();
            startGame();
        });

        init();
        drawBackground();
    </script>
</body>
</html>